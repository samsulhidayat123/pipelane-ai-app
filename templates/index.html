<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXTLEVEL</title>
    
    <!-- FAVICON (SVG Petir) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polygon points='13 2 3 14 12 14 11 22 21 10 12 10 13 2'/></svg>">

    <!-- Framework & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Outfit:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; min-height: 100vh; overflow-x: hidden; }
        .font-heading { font-family: 'Outfit', sans-serif; }
        .bg-pattern { background-image: radial-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px); background-size: 30px 30px; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .gradient-text { background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-action { background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%); transition: all 0.3s ease; }
        .btn-action:hover { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 8px 20px -6px rgba(99, 102, 241, 0.4); }
        .btn-fast { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeInUp 0.4s ease-out forwards; }

        /* Efek Neon Footer project.bysoel */
        .footer-link { transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); display: inline-block; cursor: default; }
        .footer-link:hover { letter-spacing: 0.8em; color: #818cf8; transform: scale(1.05) translateY(-5px); text-shadow: 0 0 10px rgba(129, 140, 248, 0.8), 0 0 20px rgba(129, 140, 248, 0.5); opacity: 1 !important; filter: brightness(1.5); }
        
        .loading-pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

        /* --- STYLING PROGRESS BAR --- */
        .progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; margin: 12px 0; border: 1px solid rgba(255,255,255,0.05); }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #4f46e5, #818cf8); width: 0%; transition: width 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); box-shadow: 0 0 15px rgba(79, 70, 229, 0.4); position: relative; }
        .progress-bar::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: sweep 2s infinite; }
        @keyframes sweep { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    </style>
</head>
<body class="bg-pattern flex flex-col items-center px-4">

    <!-- Header Mini -->
    <header class="w-full max-w-5xl py-6 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 bg-indigo-600 rounded-lg flex items-center justify-center">
                <i data-lucide="zap" class="text-white w-4 h-4 fill-current"></i>
            </div>
            <span class="text-lg font-bold font-heading tracking-tight uppercase">NEXT<span class="text-indigo-400">LEVEL</span></span>
        </div>
        <div class="flex gap-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest">
            <span class="hidden sm:inline">YouTube</span> &bull; <span class="hidden sm:inline">TikTok</span> &bull; <span class="hidden sm:inline">Instagram</span>
            <div class="w-2 h-2 rounded-full bg-emerald-500 loading-pulse mt-1"></div>
        </div>
    </header>

    <main class="w-full max-w-2xl mt-12 md:mt-20 text-center">
        <!-- Hero Section -->
        <div class="mb-10 animate-in">
            <h1 class="text-3xl md:text-5xl font-black font-heading mb-4 tracking-tighter leading-tight uppercase">
                SIMPAN MEDIA <br><span class="gradient-text">TANPA LIMITASI.</span>
            </h1>
            <p class="text-slate-400 text-xs md:text-sm max-w-md mx-auto opacity-80">
                Engine universal dengan dukungan <strong>Progress Tracking</strong> dan <strong>High-Definition Merging</strong>.
            </p>
        </div>

        <!-- Kolom Input URL (FETCH) -->
        <div class="glass p-1 rounded-xl flex flex-col sm:flex-row gap-2 mb-16 shadow-2xl border border-white/5 animate-in" style="animation-delay: 0.1s">
            <div class="relative flex-1 flex items-center">
                <i data-lucide="link" class="absolute left-4 text-indigo-500 w-4 h-4"></i>
                <input type="text" id="urlInput" placeholder="Tempel link video di sini..." 
                    class="w-full bg-transparent border-none py-2.5 pl-11 pr-4 text-white outline-none text-sm placeholder:text-slate-600 font-medium">
            </div>
            <button onclick="analyzeLink()" id="btnAction"
                class="btn-action text-white text-[11px] font-black py-2.5 px-8 rounded-lg flex items-center justify-center gap-2 uppercase tracking-wider">
                <span>SIKAT</span>
                <i data-lucide="zap" class="w-3.5 h-3.5 fill-current"></i>
            </button>
        </div>

        <!-- Indikator Loading Awal -->
        <div id="loader" class="hidden flex flex-col items-center py-10">
            <div class="w-8 h-8 border-2 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin"></div>
            <p class="text-[10px] font-bold text-indigo-400 mt-4 uppercase tracking-widest loading-pulse">Synchronizing Engine...</p>
        </div>

        <!-- Kartu Hasil Analisis -->
        <div id="resultBox" class="hidden opacity-0 mb-12">
            <div class="glass rounded-2xl p-4 flex flex-col sm:flex-row gap-5 text-left animate-in border border-white/10 shadow-2xl">
                <!-- Thumbnail -->
                <div class="w-full sm:w-36 flex-shrink-0 relative overflow-hidden rounded-xl">
                    <img id="resThumb" src="" class="w-full aspect-video sm:aspect-square object-cover" alt="Thumbnail">
                    <div class="absolute bottom-2 right-2">
                        <span id="resDuration" class="text-[9px] font-bold bg-black/60 backdrop-blur-md px-1.5 py-0.5 rounded text-white flex items-center gap-1">
                            <i data-lucide="clock" class="w-2.5 h-2.5"></i> 00:00
                        </span>
                    </div>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-1">
                        <span id="resPlatform" class="text-[8px] font-black text-indigo-400 uppercase tracking-widest bg-indigo-500/10 px-2 py-0.5 rounded">PLATFORM</span>
                    </div>
                    <h2 id="resTitle" class="text-sm font-bold mb-1 leading-snug line-clamp-2 font-heading uppercase tracking-tight">Judul Konten</h2>
                    <p id="resAuthor" class="text-slate-500 text-[10px] mb-2 flex items-center gap-1 font-semibold">
                        <i data-lucide="user" class="w-3 h-3 text-indigo-500"></i> <span id="uploaderName">Kreator</span>
                    </p>

                    <!-- --- UI PROGRESS BAR (Hanya muncul saat download) --- -->
                    <div id="progressUI" class="hidden animate-in">
                        <div class="flex justify-between items-center text-[9px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-1">
                            <span id="statusTxt">Striking...</span>
                            <span id="percentTxt">0%</span>
                        </div>
                        <div class="progress-container">
                            <div id="pBar" class="progress-bar"></div>
                        </div>
                    </div>

                    <!-- Tombol Opsi -->
                    <div id="downloadOptions" class="grid grid-cols-1 gap-2 mt-auto">
                        <button onclick="startDownload('fast_audio')" class="btn-fast text-white font-bold text-[10px] py-2 rounded-lg active:scale-95 transition-all flex items-center justify-center gap-2 shadow-lg">
                            <i data-lucide="zap" class="w-3.5 h-3.5 fill-current"></i> DOWNLOAD FAST AUDIO (M4A)
                        </button>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="startDownload('mp4')" class="bg-white text-black font-bold text-[10px] py-2 rounded-lg active:scale-95 transition-all flex items-center justify-center gap-2 shadow-md hover:bg-slate-100 uppercase">
                                UNDUH MP4 <i data-lucide="video" class="w-3.5 h-3.5"></i>
                            </button>
                            <button onclick="startDownload('mp3')" class="bg-slate-800 hover:bg-slate-700 text-white font-bold text-[10px] py-2 rounded-lg transition-all flex items-center justify-center gap-2 border border-white/5 active:scale-95 uppercase">
                                UNDUH MP3 <i data-lucide="music" class="w-3.5 h-3.5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notifikasi Toast -->
    <div id="toast" class="fixed bottom-6 right-6 z-50 transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none">
        <div class="glass px-4 py-2.5 rounded-lg shadow-2xl border border-white/10 flex items-center gap-2">
            <div id="toastIcon" class="w-5 h-5 bg-indigo-500/20 text-indigo-400 rounded-md flex items-center justify-center">
                <i data-lucide="info" class="w-3.5 h-3.5"></i>
            </div>
            <p id="toastMsg" class="text-[10px] font-bold text-slate-200"></p>
        </div>
    </div>

    <!-- Footer Interaktif project.bysoel -->
    <footer class="mt-auto py-12 text-center">
        <p class="footer-link text-slate-600 text-[8px] font-black tracking-[0.5em] uppercase opacity-40">
            &copy; 2026 project.bysoel &bull; NEXTLEVEL ENGINE CORE &bull; ALL RIGHTS RESERVED
        </p>
    </footer>

    <script>
        lucide.createIcons();
        let activeUrl = "";

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3500);
        }

        async function analyzeLink() {
            const url = document.getElementById('urlInput').value.trim();
            if(!url) return showToast("TEMPEL LINK DULU BRO!");
            
            document.getElementById('btnAction').disabled = true;
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('resultBox').classList.add('hidden');

            try {
                const res = await fetch('/api/info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url})
                });
                const data = await res.json();
                if(data.error) throw new Error(data.error);

                activeUrl = url;
                document.getElementById('resTitle').innerText = data.title;
                document.getElementById('resThumb').src = data.thumbnail;
                document.getElementById('resPlatform').innerText = data.platform;
                document.getElementById('resDuration').innerHTML = `<i data-lucide="clock" class="w-2.5 h-2.5"></i> ${data.duration}`;
                document.getElementById('uploaderName').innerText = data.uploader;
                
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('resultBox').classList.remove('hidden');
                setTimeout(() => document.getElementById('resultBox').classList.add('opacity-100'), 50);
                showToast("DITEMUKAN!");
            } catch(e) {
                showToast("GAGAL MENGAMBIL INFO");
                document.getElementById('loader').classList.add('hidden');
            } finally {
                document.getElementById('btnAction').disabled = false;
                lucide.createIcons();
            }
        }

        async function startDownload(format) {

    // TAMBAHKAN DI SINI
            if (!activeUrl) {
                return showToast("ANALYZE DULU BRO!");
            }
            // Sembunyikan tombol, munculkan Progress Bar
            document.getElementById('downloadOptions').classList.add('opacity-20', 'pointer-events-none');
            document.getElementById('progressUI').classList.remove('hidden');
            showToast(`CAPTURING ${format.toUpperCase()}...`);

            try {
                const res = await fetch('/api/download', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url: activeUrl, format})
                });
                const { task_id } = await res.json();

                // Connect ke SSE untuk monitoring progress
                const eventSource = new EventSource(`/api/progress/${task_id}`);
                
                eventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    const percent = data.percent || 0;
                    
                    document.getElementById('pBar').style.width = `${percent}%`;
                    document.getElementById('percentTxt').innerText = `${Math.round(percent)}%`;
                    
                    if (data.status === 'processing') {
                        document.getElementById('statusTxt').innerText = 
                            `Downloading... ${data.speed || ''} ${data.eta ? ' | ETA ' + data.eta : ''}`;
                    } else if (data.status === 'finished') {
                        eventSource.close();
                        showToast("GRAB SUCCESS!");
                        window.location.href = data.file_url; // Unduh file final
                        setTimeout(resetProgressUI, 3000);
                    } else if (data.status === 'error') {
                        eventSource.close();
                        showToast("STRIKE FAILED!");
                        resetProgressUI();
                    }
                };
            } catch(e) { 
                showToast("ENGINE ERROR"); 
                resetProgressUI();
            }
        }

        function resetProgressUI() {
            document.getElementById('downloadOptions').classList.remove('opacity-20', 'pointer-events-none');
            document.getElementById('progressUI').classList.add('hidden');
            document.getElementById('pBar').style.width = '0%';
            document.getElementById('percentTxt').innerText = '0%';
            document.getElementById('statusTxt').innerText = 'Striking...';
        }
    </script>
</body>
</html>