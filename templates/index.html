<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIRADATA-78 | AUTOMATED PIPELINE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Outfit:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; min-height: 100vh; }
        .font-heading { font-family: 'Outfit', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .gradient-text { background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-action { background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%); transition: all 0.3s ease; }
        .btn-action:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .animate-in { animation: fadeInUp 0.4s ease-out forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col items-center px-4">

    <header class="w-full max-w-5xl py-6 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                <i data-lucide="cpu" class="text-white w-5 h-5"></i>
            </div>
            <span class="text-lg font-bold font-heading uppercase tracking-tight">WIRA<span class="text-indigo-400">DATA</span></span>
        </div>
        <div id="userInfo" class="hidden flex items-center gap-4 text-[10px] font-bold">
            <span class="text-slate-500 uppercase">KREDIT: <span id="creditCount" class="text-indigo-400">0</span></span>
            <button onclick="logout()" class="text-rose-500 border border-rose-500/20 px-2 py-1 rounded">LOGOUT</button>
        </div>
    </header>

    <main class="w-full max-w-2xl mt-12 text-center">
        <div id="loginBox" class="glass p-8 rounded-2xl border border-white/5 animate-in">
            <h2 class="text-2xl font-black font-heading mb-6 uppercase">Akses <span class="gradient-text">Pipeline</span></h2>
            <div class="space-y-4">
                <input type="text" id="username" placeholder="Username" class="w-full bg-slate-900 border border-white/5 p-3 rounded-lg outline-none focus:border-indigo-500">
                <input type="password" id="password" placeholder="Password" class="w-full bg-slate-900 border border-white/5 p-3 rounded-lg outline-none focus:border-indigo-500">
                <button onclick="login()" class="btn-action w-full py-3 rounded-lg font-bold uppercase tracking-widest">MASUK KE ENGINE</button>
            </div>
            <p class="text-[10px] text-slate-500 mt-4">Belum punya akun? Hubungi <span class="text-indigo-400">WARUNG PRO</span></p>
        </div>

        <div id="engineBox" class="hidden">
            <div class="mb-10 animate-in">
                <h1 class="text-3xl md:text-5xl font-black font-heading mb-4 tracking-tighter uppercase leading-tight">
                    DEKONSTRUKSI <br><span class="gradient-text">DATA INTELLIGENCE.</span>
                </h1>
                <p class="text-slate-400 text-xs md:text-sm max-w-md mx-auto">
                    Automated Pipeline untuk guru, kreator, dan pebisnis digital.
                </p>
            </div>

            <div class="glass p-2 rounded-xl flex flex-col gap-2 mb-8 border border-white/5 animate-in">
                <input type="text" id="urlInput" placeholder="Tempel link YouTube di sini..." 
                    class="w-full bg-transparent p-4 text-white outline-none text-sm font-medium">
                
                <div class="grid grid-cols-3 gap-2 p-1">
                    <button onclick="setMode('edukasi')" id="btn-edukasi" class="mode-btn bg-slate-800 p-3 rounded-lg text-[9px] font-bold uppercase border border-white/5 hover:bg-slate-700">Wira-Guru</button>
                    <button onclick="setMode('kreator')" id="btn-kreator" class="mode-btn bg-slate-800 p-3 rounded-lg text-[9px] font-bold uppercase border border-white/5 hover:bg-slate-700">Wira-Karya</button>
                    <button onclick="setMode('bisnis')" id="btn-bisnis" class="mode-btn bg-slate-800 p-3 rounded-lg text-[9px] font-bold uppercase border border-white/5 hover:bg-slate-700">Wira-Niaga</button>
                </div>

                <button onclick="analyze()" id="btnAction" class="btn-action w-full py-4 rounded-lg font-black uppercase tracking-widest flex items-center justify-center gap-2">
                    <span>PROSES PIPELINE</span>
                    <i data-lucide="zap" class="w-4 h-4 fill-current"></i>
                </button>
            </div>

            <div id="loader" class="hidden py-10">
                <div class="w-10 h-10 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin mx-auto"></div>
                <p class="text-[10px] font-bold text-indigo-400 mt-4 uppercase tracking-[0.3em] animate-pulse">Analyzing Semantics...</p>
            </div>

            <div id="resultBox" class="hidden glass rounded-2xl p-6 text-left border border-white/10 shadow-2xl animate-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-black text-indigo-400 uppercase tracking-widest">AI Result Analysis</h3>
                    <button onclick="downloadPDF()" class="bg-emerald-500/20 text-emerald-400 px-3 py-1.5 rounded-lg text-[9px] font-bold flex items-center gap-2 hover:bg-emerald-500/30 transition-all">
                        <i data-lucide="file-text" class="w-3.5 h-3.5"></i> CETAK PDF
                    </button>
                </div>
                <div id="resultText" class="text-sm text-slate-300 leading-relaxed whitespace-pre-wrap font-medium"></div>
            </div>
        </div>
    </main>

    <footer class="mt-auto py-12 text-center opacity-40">
        <p class="text-slate-600 text-[8px] font-black tracking-[0.5em] uppercase">
            &copy; 2026 PROJECT.78 &bull; AUTOMATED PIPELINE ENGINE &bull; WARUNG PRO
        </p>
    </footer>

    <script>
        lucide.createIcons();
        let selectedMode = 'edukasi';

        function setMode(mode) {
            selectedMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('border-indigo-500', 'text-indigo-400'));
            document.getElementById(`btn-${mode}`).classList.add('border-indigo-500', 'text-indigo-400');
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            if (res.ok) {
                const data = await res.json();
                document.getElementById('loginBox').classList.add('hidden');
                document.getElementById('engineBox').classList.remove('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('creditCount').innerText = data.user.credits;
                setMode('edukasi');
            } else {
                alert("Login Gagal, Bro!");
            }
        }

        async function analyze() {
            const url = document.getElementById('urlInput').value;
            if(!url) return alert("Link kosong!");

            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('resultBox').classList.add('hidden');

            const res = await fetch('/api/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({url, mode: selectedMode})
            });
            
            const data = await res.json();
            document.getElementById('loader').classList.add('hidden');
            
            if(data.error) {
                alert(data.error);
            } else {
                document.getElementById('resultText').innerText = data.result;
                document.getElementById('creditCount').innerText = data.remaining_credits;
                document.getElementById('resultBox').classList.remove('hidden');
            }
        }

        function downloadPDF() {
            window.location.href = '/api/export-pdf';
        }

        function logout() { location.reload(); }
    </script>
</body>
</html>